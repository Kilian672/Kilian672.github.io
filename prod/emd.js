!function(e){var t={};function a(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,a),s.l=!0,s.exports}a.m=e,a.c=t,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)a.d(n,s,function(t){return e[t]}.bind(null,s));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=0)}([function(e,t,a){"use strict";a.r(t);const n={i:"",s:"",sr:"",sm:"",t:"",tr:"",tm:""};n.i="Double click an empty space in the <b>Model</b> pane to create a state.<br>Click an object to select it.<br>Drag a state to improve readability.<br>",n.s="Press <b>DEL</b> to delete the state.<br>Press <b>INS</b> to rename the state.<br>Hold <b>CTRL</b> and click a state to create a transition.<br>Click an empty space for more options.",n.sr="Press <b>CTRL</b> + <b>l</b> (latin), <b>g</b> (greek), <b>s</b> (symbol) to choose an alphabet.<br>Enter letters (<b>a</b> or <b>A</b>) to change the name.<br>Enter numbers (<b>1</b>, <b>2</b>, <b>12</b>) to add a subscript<br>Delete with <b>BACKSPACE</b>, confirm with <b>ENTER</b> or click.",n.t="Press <b>DEL</b> to delete the transition.<br>Press <b>INS</b> to rename the transition.<br>Hold <b>t</b> to choose a transition target (<b>s</b>ource, <b>f</b>actor).<br>Click an empty space for more options.",n.tr=n.sr,n.sm=n.s,n.tm=n.t;var s=n;const i={check:"",Delete:"",rename:"",in:"",out:"",S:"",G:"",L:"",up:"",low:"",T:"",X:"",target:"",source:""};i.check="Confirm the name",i.Delete="Delete the active",i.rename="Click this button to Rename",i.in="Create a specialArrow in",i.out="Create a specialArrow out",i.S="special alphabet keyboard",i.G="greek alphabet keyboard",i.L="latin alphabet keyboard",i.up="Upper case alphabet",i.low="Lower case alphabet",i.T="Create a new Transition",i.X="Vallidate your input",i.target="Choose a new target",i.source="Choose a new source";var r=i;const o={L:{S:null,C:null},G:{S:null,C:null},S:{S:null,C:null}};o.L.S={A:119886,B:119887,C:119888,D:119889,E:119890,F:119891,G:119892,H:8462,I:119894,J:119895,K:119896,L:119897,M:119898,N:119899,O:119900,P:119901,Q:119902,R:119903,S:119904,T:119905,U:119906,V:119907,W:119908,X:119909,Y:119910,Z:119911,0:8320,1:8321,2:8322,3:8323,4:8324,5:8325,6:8326,7:8327,8:8328,9:8329},o.L.C={A:119860,B:119861,C:119862,D:119863,E:119864,F:119865,G:119866,H:119867,I:119868,J:119869,K:119870,L:119871,M:119872,N:119873,O:119874,P:119875,Q:119876,R:119877,S:119878,T:119879,U:119880,V:119881,W:119882,X:119883,Y:119884,Z:119885,0:8320,1:8321,2:8322,3:8323,4:8324,5:8325,6:8326,7:8327,8:8328,9:8329},o.G.S={A:120572,B:120573,C:120585,D:120575,E:120576,F:120593,G:120574,H:120578,I:120580,J:120589,K:120581,L:120582,M:120583,N:120584,O:120586,P:120587,Q:120579,R:120588,S:120590,T:120591,U:120592,W:120596,X:120594,Y:120595,Z:120577,0:8320,1:8321,2:8322,3:8323,4:8324,5:8325,6:8326,7:8327,8:8328,9:8329},o.G.C={A:120546,B:120547,C:120559,D:120549,E:120550,F:120567,G:120548,H:120552,I:120554,K:120555,L:120556,M:120557,N:120558,O:120560,P:120561,Q:120553,R:120562,S:120564,T:120565,U:120566,W:120570,X:120568,Y:120569,Z:120551,0:8320,1:8321,2:8322,3:8323,4:8324,5:8325,6:8326,7:8327,8:8328,9:8329},o.S.S={E:120598,F:120601,K:120600,P:120603,Q:120599,R:120602,0:8320,1:8321,2:8322,3:8323,4:8324,5:8325,6:8326,7:8327,8:8328,9:8329},o.S.C={Q:120563,0:8320,1:8321,2:8322,3:8323,4:8324,5:8325,6:8326,7:8327,8:8328,9:8329};var l=o;var c={stateRadius:20,snapToPadding:6,hitTargetPadding:6,instancesLimit:1e6,specialArrowLimit:5,stateDefaultColour:"black",stateSelectedColour:"blue",stateTransitionFactorColour:"red",transitionDefaultColour:"black",transitionSelectedColour:"blue",transitionStateFactorColour:"red",stateKeys:{Rename:45,Delete:46,Transition:17},transitionKeys:{Rename:45,Delete:46,Target:84,Source:83,Factor:70},canvas:null,context:null,buildString:e=>{let t="";for(let a=0;a<e.length;a+=1)t+=String.fromCodePoint(e[a]);return t}};var d=class{constructor(e,t,a,n=c.stateRadius){this.radius=n,this.x=Math.min(t,c.canvas.width-this.radius),this.x=Math.max(this.x,this.radius),this.y=Math.min(a,c.canvas.height-this.radius),this.y=Math.max(this.y,this.radius),this.moveOffsetX=0,this.moveOffsetY=0,this.id=e,this.nameArr=[],this.name="",this.data=[],this.colour=c.stateDefaultColour,this.lineWidth=1,this.transitions={in:[],out:[],factor:[]}}transitionAdd(e,t){this.transitions[t][e.id]=e}transitionDelete(e,t){delete this.transitions[t][e.id]}updateTransitions(){let e;for(e in this.transitions.factor)this.transitions.factor[e].nameUpdate()}activate(){let e;for(e in this.colour=c.stateSelectedColour,this.transitions.factor)this.transitions.factor[e].colour=c.stateTransitionFactorColour}deactivate(){let e;for(e in this.colour=c.stateDefaultColour,this.transitions.factor)this.transitions.factor[e].colour=c.transitionDefaultColour}moveStart(e,t){this.moveOffsetX=e-this.x,this.moveOffsetY=t-this.y}move(e,t){let a;for(a in this.x=e-this.moveOffsetX,this.y=t-this.moveOffsetY,this.x=Math.min(this.x,c.canvas.width-this.radius),this.x=Math.max(this.x,this.radius),this.y=Math.min(this.y,c.canvas.height-this.radius),this.y=Math.max(this.y,this.radius),this.transitions.in)this.transitions.in[a].updateShape();for(a in this.transitions.out)this.transitions.out[a].updateShape()}moveStop(){this.moveOffsetX=0,this.moveOffsetY=0}nameAddChr(e){this.nameArr.push(e),this.name+=String.fromCodePoint(e)}nameRemoveChr(){return 0!==this.nameArr.length&&(this.nameArr.pop(),this.name=c.buildString(this.nameArr),!0)}draw(){if(0!==this.radius){const e=c.context;e.lineWidth=this.lineWidth,e.strokeStyle=this.colour,e.fillStyle=this.colour,e.font="20px Verdana, Geneva, Tahoma, sans-serif",e.textAlign="center",e.textBaseline="middle",e.beginPath(),e.arc(this.x,this.y,this.radius,0,2*Math.PI),e.stroke(),e.fillText(this.name,this.x,this.y)}}closestPointOnCircle(e,t){const a=e-this.x,n=t-this.y,s=Math.sqrt(a*a+n*n);return{x:this.x+a*this.radius/s,y:this.y+n*this.radius/s}}};let h={},u={};function p(e){return e.preventDefault(),0!==e.button||(h.mouseDown(e),u.focus()),!1}function b(e){return e.preventDefault(),!1}function m(e){return e.preventDefault(),!1}function v(e){return e.preventDefault(),h.dblClick(e),!1}function f(e){return e.preventDefault(),0===e.button&&h.mouseCancel(e),!1}function g(e){h.mouseCancel(e)}function y(e){h.mouseMove(e)}function S(e){return e.preventDefault(),h.keyDown(e),!1}function w(e){h.keyUp(e)}var C=function(e,t){u=e,h=t,u.addEventListener("mousedown",p),u.addEventListener("click",b),u.addEventListener("dblclick",v),u.addEventListener("contextmenu",m),u.addEventListener("mousemove",y),u.addEventListener("mouseup",f),u.addEventListener("mouseout",g),u.addEventListener("keydown",S),u.addEventListener("keyup",w)};let k={};const x={};let D={},A={};function I(){let e;return e="s"===D.state?D.selectionTransitionTarget?"t":"i":"sm"===D.state?"m":"sr"===D.state?"r":null,e}x.mouseDown=e=>{switch(I()){case"i":D.systemStateMouseDown(e.offsetX,e.offsetY);break;case"t":A.stateSelectTransitionTarget(e);break;case"r":A.stateRenameExitSelect(e)}},x.mouseMove=e=>{"m"===I()&&D.moveObject(e)},x.mouseCancel=()=>{"m"===I()&&D.moveStop()},x.keyDown=e=>{const t=I(),a=e.keycode||e.which;switch(t){case"i":!function(e){switch(e){case k.Transition:A.stateActivateTransition();break;case k.Rename:A.stateActivateRename();break;case k.Delete:A.stateActivateDelete()}}(a);break;case"r":A.renameKeyDown(e)}},x.keyUp=e=>{const t=I(),a=e.keycode||e.which;"t"===t&&a===k.Transition&&A.stateActivateIdle()},x.init=(e,t,a)=>{D=e,k=a,A=t};var M=x;let T={};const E={};let K={},P={};function O(){let e;return e="t"===K.state?K.selectionTransitionTarget?"t":K.selectionTransitionSource?"s":K.selectionTransitionFactor?"f":"i":"tm"===K.state?"m":"tr"===K.state?"r":null,e}E.mouseDown=e=>{switch(O()){case"i":K.systemStateMouseDown(e.offsetX,e.offsetY);break;case"t":P.transitionSelectTarget(e);break;case"s":P.transitionSelectSource(e);break;case"f":P.transitionSelectFactor(e);break;case"r":P.transitionRenameExitSelect(e)}},E.mouseMove=e=>{"m"===O()&&K.moveObject(e)},E.mouseCancel=()=>{"m"===O()&&K.moveStop()},E.keyDown=e=>{switch(O()){case"i":!function(e){switch(e.keycode||e.which){case T.Target:P.transitionActivateTarget();break;case T.Source:P.transitionActivateSource();break;case T.Factor:P.transitionActivateFactor();break;case T.Rename:P.transitionActivateRename();break;case T.Delete:P.transitionActivateDelete()}}(e)}},E.keyUp=e=>{const t=O(),a=e.keycode||e.which;("t"===t&&a===T.Target||"s"===t&&a===T.Source||"f"===t&&a===T.Factor)&&P.transitionActivateIdle()},E.init=(e,t,a)=>{K=e,P=t,T=a};var H=E;const L={};let X={},B={};L.mouseDown=e=>{X.systemStateMouseDown(e.offsetX,e.offsetY)},L.dblClick=e=>{B.stateCreate(e)},L.init=(e,t)=>{X=e,B=t};var R=L;const N={};let j={};function G(){let e;switch(j.state){case"s":case"sr":case"sm":e="s";break;case"t":case"tr":case"tm":e="t";break;case"i":e="i"}return e}N.mouseDown=e=>{switch(G()){case"i":R.mouseDown(e);break;case"s":M.mouseDown(e);break;case"t":H.mouseDown(e)}},N.dblClick=e=>("i"!==G()||R.dblClick(e),!1),N.mouseCancel=()=>{switch(G()){case"s":M.mouseCancel();break;case"t":H.mouseCancel()}},N.mouseMove=e=>{switch(G()){case"s":M.mouseMove(e);break;case"t":H.mouseMove(e)}},N.keyDown=e=>{switch(G()){case"s":M.keyDown(e);break;case"t":H.keyDown(e)}},N.keyUp=e=>{switch(G()){case"s":M.keyUp(e);break;case"t":H.keyUp(e)}};var V=function(e,t,a,n,s,i){C(e,N),j=t,R.init(j,a),M.init(j,a,s),H.init(j,n,i)};let F={},U={},Y=0,z=0,J=100;const _={s:0,t:0},W={};function q(e,t,a){return F.beginPath(),F.arc(a.x,a.y,z,0,2*Math.PI),F.closePath(),!!F.isPointInPath(e,t)}function Z(e,t,a){const n=a.shape.source.point,s=a.shape.target.point,i=s.x-n.x,r=s.y-n.y,o=Math.sqrt(i*i+r*r),l=(i*(e-n.x)+r*(t-n.y))/(o*o),c=(i*(t-n.y)-r*(e-n.x))/o;return l>0&&l<1&&Math.abs(c)<Y}W.shMap=new Map,W.getShape=e=>W.shMap.get(e),W.findShape=(e,t)=>{let a,n,s;for([a,s]of W.shMap)switch(n=a.substring(0,1),n){case"s":if(q(e,t,s))return s;break;case"t":if(Z(e,t,s))return s}return null},W.stateconflict=e=>{let t,a,n;const s=e.id;for([t,a]of W.shMap)switch(n=t.substring(0,1),n){case"s":if((e.x-a.x)*(e.x-a.x)+(e.y-a.y)*(e.y-a.y)<=4*z*z&&s!==t)return!0}return!1},W.findStateNameConflict=e=>{let t,a;const n=e.id,s=e.name;for([t,a]of W.shMap)if("s"===t.substring(0,1)&&a.name===s&&t!==n)return a;return null},W.generateFreeID=e=>_[e]>=J?"":(_[e]+=1,e+(_[e]-1)),W.draw=()=>{let e;for(e of(F.clearRect(0,0,U.width,U.height),W.shMap.values()))e.draw()},W.addShape=(e,t)=>{W.shMap.set(e,t)},W.deleteShape=e=>{W.shMap.delete(e)},W.init=(e,t,a,n)=>{U=e,F=U.getContext("2d"),z=t,Y=a,J=n};var Q=W;let ee={},te={},ae={},ne=0;const se={stateSelectTransitionTarget:e=>{const t=te.activeShape,a=ee.findShape(e.offsetX,e.offsetY);if(null==a||"s"!==a.id.substring(0,1)||a.id===t.id)return;t.deactivate();const n=ae.transitionCreate(t,a);te.systemStateActivate("tr",n),ee.draw()},renameKeyDown:e=>{let t=e.keyCode||e.which;const a=te.activeShape;if(13===t&&se.renameValidate())return te.systemStateActivate("s",a),ee.draw(),!0;if(e.ctrlKey)return t=String.fromCharCode(t),"L"!==t&&"G"!==t&&"S"!==t||(te.alphabet=t),!0;if(8===t)return a.nameRemoveChr(),ee.draw(),!0;t=String.fromCharCode(t);const n=te.symbols[te.alphabet][e.shiftKey?"C":"S"][t];return void 0===n||(a.nameAddChr(n),ee.draw()),!0},stateName:e=>"sr"===te.state&&(te.activeShape.nameAddChr(e),ee.draw(),!0),nameRemoveToken:()=>(te.activeShape.nameRemoveChr(),ee.draw(),!0),checkName:()=>{if(se.renameValidate())return te.systemStateActivate("s",te.activeShape),ee.draw(),!0},stateRenameExitSelect:e=>{se.renameValidate()&&te.systemStateMouseDown(e.offsetX,e.offsetY)},renameValidate:()=>{const e=te.activeShape;if(0===e.name.length)return alert("Please provide a name!"),!1;if("𝑁"===e.name)return alert("The name 𝑁 is blocked!"),!1;return null!==ee.findStateNameConflict(e)?(alert("There already exists a state with this name!"),!1):(e.name!==te.nameOld&&(e.updateTransitions(),te.callback(ee.shMap)),!0)},stateActivateTransition:()=>{te.selectionTransitionTarget=!0},stateActivateRename:()=>{te.systemStateActivate("sr",te.activeShape)},stateActivateDelete:()=>{"s0"!==te.activeShape.id&&(se.stateDelete(te.activeShape),te.systemStateActivate("i",null),ee.draw())},stateActivateIdle:()=>{te.selectionTransitionTarget=!1},stateCreate:e=>{const t=ee.generateFreeID("s");if(0===t.length)return alert("Only "+ne+" states allowed, limit reached!"),!1;const a=new d(t,e.offsetX,e.offsetY);return ee.stateconflict(a)?(alert("Collision with another State"),!1):(ee.addShape(t,a),te.systemStateActivate("sr",a),ee.draw(),!1)},stateDelete:e=>{let t;for(t in e.deactivate(),e.transitions.in)ae.transitionDelete(ee.getShape(t),!1);for(t in e.transitions.out)ae.transitionDelete(ee.getShape(t),!1);for(t in e.transitions.factor)ae.transitionDelete(ee.getShape(t),!1);ee.deleteShape(e.id),te.callback(ee.shMap)},init:(e,t,a,n)=>{ee=e,te=t,ae=a,ne=n}};var ie=se;var re=class{constructor(e,t,a){this.id=e,this.nameArr=[],this.name="",this.colour=c.transitionDefaultColour,this.lineWidth=1,this.shape={source:{point:{x:0,y:0}},target:{point:{x:0,y:0}}},this.factors=[],t.transitionAdd(this,"out"),a.transitionAdd(this,"in"),this.source=t,this.target=a,this.updateShape()}delete(){let e;for(e in this.deactivate(),this.source.transitionDelete(this,"out"),this.target.transitionDelete(this,"in"),this.factors)this.factors[e].transitionDelete(this,"factor")}setTarget(e){this.target.transitionDelete(this,"in"),this.target=e,e.transitionAdd(this,"in"),this.updateShape()}setSource(e){this.source.transitionDelete(this,"out"),this.source=e,e.transitionAdd(this,"out"),this.updateShape()}activate(){let e;for(e in this.colour=c.transitionSelectedColour,this.factors)this.factors[e].colour=c.transitionStateFactorColour}deactivate(){let e;for(e in this.colour=c.transitionDefaultColour,this.factors)this.factors[e].colour=c.stateDefaultColour}moveStart(e,t){}move(e,t){}moveStop(){}updateShape(){const e=(this.source.x+this.target.x)/2,t=(this.source.y+this.target.y)/2;this.shape.source.point=this.source.closestPointOnCircle(e,t),this.shape.target.point=this.target.closestPointOnCircle(e,t)}nameUpdate(){let e,t,a;const n=this.nameArr,s=n.length;for(this.name="",e=0;e<s;e+=1)[t,a]=n[e],this.name+="s"!==t?String.fromCodePoint(a):a.name}factorUpdate(){let e,t,a;const n=this.nameArr,s=n.length;for(e in this.factors)this.factors[e].transitionDelete(this,"factor"),this.factors[e].colour=c.stateDefaultColour;for(this.factors=[],e=0;e<s;e+=1)[t,a]=n[e],"s"===t&&(this.factors[a.id]=a,a.transitionAdd(this,"factor"),a.colour=c.transitionStateFactorColour)}nameAddToken(e,t){const a=this.nameArr,n=a.length,s=n>0?a[n-1][0]:"";return("o"!==e||"o"!==s)&&(this.nameArr.push([e,t]),this.nameUpdate(),this.factorUpdate(),!0)}nameRemoveToken(){return 0!==this.nameArr.length&&(this.nameArr.pop(),this.nameUpdate(),this.factorUpdate(),!0)}nameNormalize(){const e=this.nameArr,t=e.length;t>0&&"o"===e[t-1][0]&&this.nameRemoveToken()}draw(){const e=c.context;e.lineWidth=this.lineWidth,e.strokeStyle=this.colour,e.fillStyle=this.colour,e.font="20px Verdana, Geneva, Tahoma, sans-serif",e.textAlign="center",e.textBaseline="middle",e.beginPath(),e.moveTo(this.shape.source.point.x,this.shape.source.point.y),e.lineTo(this.shape.target.point.x,this.shape.target.point.y),e.stroke();let t=this.shape.target.point.x-this.shape.source.point.x,a=this.shape.target.point.y-this.shape.source.point.y;const n=Math.sqrt(t*t+a*a);t/=n,a/=n,e.beginPath(),e.moveTo(this.shape.target.point.x,this.shape.target.point.y),e.lineTo(this.shape.target.point.x-8*t+5*a,this.shape.target.point.y-8*a-5*t),e.lineTo(this.shape.target.point.x-8*t-5*a,this.shape.target.point.y-8*a+5*t),e.fill();let s=(this.shape.source.point.x+this.shape.target.point.x)/2,i=(this.shape.source.point.y+this.shape.target.point.y)/2;s+=15*a,i+=-15*t,e.fillText(this.name,s,i)}};let oe={},le={},ce={},de=0;const he={transitionCreate:(e,t)=>{const a=oe.generateFreeID("t");if(0===a.length)return alert("Only "+de+" transitions allowed, limit reached!"),null;const n=new re(a,e,t);return oe.addShape(a,n),n},transitionSelectTarget:e=>{ce.rearrangement();const t=oe.findShape(e.offsetX,e.offsetY);null!==t&&"s"===t.id.substring(0,1)&&t.id!==le.activeShape.source.id&&t.id!==le.activeShape.target.id&&(ce.limitspAinreached(t)?alert("limit reached"):(le.activeShape.deactivate(),le.activeShape.setTarget(t),le.activeShape.activate(),ce.arrangement(),le.callback(oe.shMap),oe.draw()))},transitionSelectSource:e=>{ce.rearrangement();const t=oe.findShape(e.offsetX,e.offsetY);null!=t&&"s"===t.id.substring(0,1)&&t.id!==le.activeShape.source.id&&t.id!==le.activeShape.target.id&&(ce.limitspAoutreached(t)?alert("limit reached"):(le.activeShape.deactivate(),le.activeShape.setSource(t),le.activeShape.activate(),ce.arrangement(),le.callback(oe.shMap),oe.draw()))},transitionSelectFactor:e=>{const t=oe.findShape(e.offsetX,e.offsetY);null!==t&&"s"===t.id.substring(0,1)&&(le.activeShape.deactivate(),le.activeShape.toggleFactor(t),le.activeShape.activate(),le.callback(oe.shMap),oe.draw())},transitionActivateTarget:()=>{le.selectionTransitionTarget=!0},transitionActivateSource:()=>{le.selectionTransitionSource=!0},transitionActivateFactor:()=>{le.selectionTransitionFactor=!0},transitionActivateDelete:()=>{he.transitionDelete(le.activeShape),le.systemStateActivate("i",null),oe.draw()},transitionActivateIdle:()=>{le.selectionTransitionTarget=!1,le.selectionTransitionSource=!1,le.selectionTransitionFactor=!1},transitionDelete:(e,t=!0)=>{e.delete(),oe.deleteShape(e.id),t&&le.callback(oe.shMap)},transitionActivateRename:()=>{le.systemStateActivate("tr",le.activeShape)},nameValidate:()=>{const e=le.activeShape;return 0===e.name.length?(alert("Please provide a name!"),!1):(e.name!==le.nameOld&&le.callback(oe.shMap),!0)},nameAppendRate:e=>"tr"===le.state&&(le.activeShape.nameAddToken("r",e),oe.draw(),!0),nameAppendPlus:()=>"tr"===le.state&&(le.activeShape.nameAddToken("o",65291),oe.draw(),!0),nameConfirm:()=>"tr"===le.state&&(le.activeShape.nameNormalize(),oe.draw(),!!he.nameValidate()&&(le.systemStateActivate("t",le.activeShape),oe.draw(),!0)),transitionRenameExitSelect:e=>{le.activeShape.nameNormalize(),he.nameValidate()&&le.systemStateMouseDown(e.offsetX,e.offsetY)},nameAppendState:e=>"tr"===le.state&&(le.activeShape.nameAddToken("s",e),oe.draw(),!0),nameRemoveToken:()=>"tr"===le.state&&(le.activeShape.nameRemoveToken(),oe.draw(),!0),init:(e,t,a,n)=>{oe=e,le=t,de=a,ce=n}};var ue=he;const pe=[],be={addListener:e=>{pe.push(e)},update:e=>{pe.forEach(t=>{t(e)})}};var me=be;let ve="http://www.w3.org/2000/svg",fe=35;const ge={setNS:e=>{ve=e},getNS:()=>ve,setKeySize:e=>{fe=e},getKeySize:()=>fe,createKey:function(e,t,a){const n=document.createElementNS(ve,"g");return n.setAttributeNS(null,"transform","translate("+e+","+t+")"),n.appendChild(function(){const e=document.createElementNS(ve,"rect");return e.setAttributeNS(null,"x",0),e.setAttributeNS(null,"y",0),e.setAttributeNS(null,"width",fe),e.setAttributeNS(null,"height",fe),e.style.strokeWidth=1,e.style.stroke="black",e.setAttributeNS(null,"fill","white"),e}()),n.appendChild(function(e){const t=document.createElementNS(ve,"text");return t.setAttributeNS(null,"x",.5*fe),t.setAttributeNS(null,"y",.5*fe),t.style.textAnchor="middle",t.style.alignmentBaseline="central",t.style.font="20px Verdana, Geneva, Tahoma, sans-serif",t.style.fill="black",t.style.pointerEvents="none",t.innerHTML=e,t}(a)),n}};var ye=ge;let Se="http://www.w3.org/2000/svg",we=35,Ce=13;const ke={check:null,del:null,plus:null,L:null,G:null,S:null,up:null,low:null,Del:null,R:null,T:null,X:null,target:null,source:null,in:null,out:null,checkenter:null,Deleteenter:null,Renter:null,inenter:null,outenter:null,Lenter:null,Genter:null,Senter:null,upenter:null,lowenter:null,Tenter:null,Xenter:null,targetenter:null,sourceenter:null},xe=10003,De=11013,Ae=65291,Ie=76,Me=71,Te=83,Ee=8593,$e=8595,Ke=9249,Pe=82,Oe=8594,He=88,Le=8614,Xe=8620,Be=8681,Re=8679;function Ne(e,t){t.addEventListener("mousedown",t=>(t.preventDefault(),0!==t.button||ke[e](),!1))}function je(e,t){t.addEventListener("mouseenter",t=>(t.preventDefault(),0!==t.button||ke[e](),!1))}const Ge={setNS:e=>{Se=e},getNS:()=>Se,setKeySize:e=>{we=e},getKeySize:()=>we,setColoumnCount:e=>{Ce=e},getColoumnCount:()=>Ce,setHandler:(e,t)=>{ke[e]=t},getHandler:e=>ke[e],create:function(e,t,a){let n,s;ye.setKeySize(we),ye.setNS(Se);const i=document.createElementNS(Se,"g");switch(i.setAttributeNS(null,"transform","translate("+e+","+t+")"),a){case"s":s=String.fromCodePoint(Ke),n=ye.createKey(we*(Ce-13),0,s),Ne("Del",n),je("Deleteenter",n),i.appendChild(n),s=String.fromCodePoint(Pe),n=ye.createKey(we*(Ce-12),0,s),Ne("R",n),je("Renter",n),i.appendChild(n),s=String.fromCodePoint(Oe),n=ye.createKey(we*(Ce-11),0,s),Ne("T",n),je("Tenter",n),i.appendChild(n),s=String.fromCodePoint(Be),n=ye.createKey(we*(Ce-10),0,s),Ne("in",n),je("inenter",n),i.appendChild(n),s=String.fromCodePoint(Re),n=ye.createKey(we*(Ce-9),0,s),Ne("out",n),je("outenter",n),i.appendChild(n);break;case"t":s=String.fromCodePoint(Ke),n=ye.createKey(we*(Ce-13),0,s),Ne("Del",n),je("Deleteenter",n),i.appendChild(n),s=String.fromCodePoint(Pe),n=ye.createKey(we*(Ce-12),0,s),Ne("R",n),i.appendChild(n),je("Renter",n),s=String.fromCodePoint(Le),n=ye.createKey(we*(Ce-11),0,s),Ne("target",n),je("targetenter",n),i.appendChild(n),s=String.fromCodePoint(Xe),n=ye.createKey(we*(Ce-10),0,s),Ne("source",n),je("sourceenter",n),i.appendChild(n);break;case"tspecialin":s=String.fromCodePoint(Ke),n=ye.createKey(we*(Ce-13),0,s),Ne("Del",n),je("Deleteenter",n),i.appendChild(n),s=String.fromCodePoint(Pe),n=ye.createKey(we*(Ce-12),0,s),Ne("R",n),je("Renter",n),i.appendChild(n),s=String.fromCodePoint(Le),n=ye.createKey(we*(Ce-11),0,s),Ne("target",n),je("targetenter",n),i.appendChild(n);break;case"tspecialout":s=String.fromCodePoint(Ke),n=ye.createKey(we*(Ce-13),0,s),Ne("Del",n),je("Deleteenter",n),i.appendChild(n),s=String.fromCodePoint(Pe),n=ye.createKey(we*(Ce-12),0,s),Ne("R",n),je("Renter",n),i.appendChild(n),s=String.fromCodePoint(Xe),n=ye.createKey(we*(Ce-10),0,s),Ne("source",n),je("sourceener",n),i.appendChild(n);break;case"X":s=String.fromCodePoint(He),n=ye.createKey(we*(Ce-13),0,s),Ne("X",n),je("Xenter",n),i.appendChild(n);break;case"name":s=String.fromCodePoint(Ae),n=ye.createKey(we*(Ce-5),0,s),Ne("plus",n),i.appendChild(n),s=String.fromCodePoint(De),n=ye.createKey(we*(Ce-3),0,s),Ne("del",n),i.appendChild(n),s=String.fromCodePoint(xe),n=ye.createKey(we*(Ce-1),0,s),Ne("check",n),je("checkenter",n),i.appendChild(n),s=String.fromCodePoint(Ie),n=ye.createKey(we*(Ce-13),0,s),Ne("L",n),je("Lenter",n),i.appendChild(n),s=String.fromCodePoint(Me),n=ye.createKey(we*(Ce-12),0,s),Ne("G",n),je("Genter",n),i.appendChild(n),s=String.fromCodePoint(Te),n=ye.createKey(we*(Ce-11),0,s),Ne("S",n),je("Senter",n),i.appendChild(n),s=String.fromCodePoint(Ee),n=ye.createKey(we*(Ce-9),0,s),Ne("up",n),je("upenter",n),i.appendChild(n),s=String.fromCodePoint($e),n=ye.createKey(we*(Ce-8),0,s),Ne("low",n),je("lowenter",n),i.appendChild(n)}return i}};var Ve=Ge;let Fe="http://www.w3.org/2000/svg",Ue=35,Ye=13,ze=null;function Je(e,t){t.addEventListener("mousedown",t=>(t.preventDefault(),0!==t.button||ze(e),!1))}const _e={setNS:e=>{Fe=e},getNS:()=>Fe,setKeySize:e=>{Ue=e},getKeySize:()=>Ue,setColoumnCount:e=>{Ye=e},getColoumnCount:()=>Ye,setHandler:e=>{ze=e},getHandler:()=>ze,createAlphabet:function(e,t,a,n){let s,i,r,o,c=0,d=0,h=65;ye.setKeySize(Ue),ye.setNS(Fe);const u=document.createElementNS(Fe,"g");for(u.setAttributeNS(null,"transform","translate("+e+","+t+")");h<91;)s=String.fromCharCode(h),i=l[a][n][s],void 0!==i&&(r=String.fromCodePoint(i),o=ye.createKey(d*Ue,c*Ue,r),Je(i,o),u.appendChild(o),d+=1,d===Ye&&(d=0,c+=1)),h+=1;return u}};var We=_e;let qe=35,Ze=13,Qe="http://www.w3.org/2000/svg",et=null;const tt={};function at(e,t){t.addEventListener("mousedown",t=>(t.preventDefault(),0!==t.button||et(e),!1))}tt.setNS=e=>{Qe=e},tt.getNS=()=>Qe,tt.setKeySize=e=>{qe=e},tt.getKeySize=()=>qe,tt.setColoumnCount=e=>{Ze=e},tt.getColoumnCount=()=>Ze,tt.getHandler=()=>et,tt.setHandler=e=>{et=e},tt.create=function(e,t,a){let n,s,i,r=0,o=0;ye.setKeySize(qe),ye.setNS(Qe);const l=document.createElementNS(Qe,"g");for([n,s]of(l.setAttributeNS(null,"transform","translate("+e+","+t+")"),a))"n"===n.substring(0,1)&&(i=ye.createKey(o*qe,r*qe,s.name),at(s,i),l.appendChild(i),o+=1,o===Ze&&(o=0,r+=1)),"s"===n.substring(0,1)&&(i=ye.createKey(o*qe,r*qe,s.name),at(s,i),l.appendChild(i),o+=1,o===Ze&&(o=0,r+=1));return l};var nt=tt;let st="http://www.w3.org/2000/svg",it=13,rt=35,ot=10,lt=null,ct=null,dt=null,ht=null,ut=null,pt=null,bt=null;const mt={plus:null,del:null,check:null,L:null,G:null,S:null,up:null,low:null,Del:null,R:null,T:null,X:null,target:null,source:null,in:null,out:null,checkenter:null,Deleteenter:null,Renter:null,inenter:null,outenter:null,Lenter:null,Genter:null,Senter:null,upenter:null,lowenter:null,Tenter:null,Xenter:null,targetenter:null,sourceenter:null};let vt=[10,55];const ft={};function gt(){nt.setColoumnCount(it),nt.setKeySize(rt),nt.setNS(st),nt.setHandler(bt)}function yt(e){gt();const t=nt.create(vt[0],vt[1],e);null!==ht&&ct.removeChild(ht),ct.appendChild(t),ht=t}ft.updateAlphabet=(e,t)=>{ct.removeChild(dt),dt=We.createAlphabet(ot,2*ot+rt,e,t),ct.appendChild(dt)},ft.Alphabetvisibility=e=>{dt.setAttributeNS(null,"visibility",e)},ft.updateAlphabetCase=e=>{if("up"==e){let e=dt.getElementsByTagName("text")[0].innerHTML;switch(e=e.charCodeAt(1),e){case 56398:ct.removeChild(dt),dt=We.createAlphabet(ot,2*ot+rt,"L","C"),ct.appendChild(dt);break;case 57084:ct.removeChild(dt),dt=We.createAlphabet(ot,2*ot+rt,"G","C"),ct.appendChild(dt);break;case 57110:ct.removeChild(dt),dt=We.createAlphabet(ot,2*ot+rt,"S","C"),ct.appendChild(dt)}}else{let e=dt.getElementsByTagName("text")[0].innerHTML;switch(e=e.charCodeAt(1),e){case 56372:ct.removeChild(dt),dt=We.createAlphabet(ot,2*ot+rt,"L","S"),ct.appendChild(dt);break;case 57058:ct.removeChild(dt),dt=We.createAlphabet(ot,2*ot+rt,"G","S"),ct.appendChild(dt);break;case 57075:ct.removeChild(dt),dt=We.createAlphabet(ot,2*ot+rt,"S","S"),ct.appendChild(dt)}}},ft.updateSpecialKeys=e=>{ct.removeChild(ut),ut=Ve.create(ot,ot,e),ct.appendChild(ut)},ft.StateKeysvisibility=e=>{ht.setAttributeNS(null,"visibility",e)},ft.visibility=e=>{ct.setAttributeNS(null,"visibility",e)},ft.init=(e,t)=>{lt=e,function(){const e=2*ot+rt*it,t=4*ot+5*rt;ct=document.createElementNS(st,"svg"),ct.setAttributeNS(null,"width",e+"px"),ct.setAttributeNS(null,"height",t+"px")}(),Ve.setKeySize(rt),Ve.setNS(st),Ve.setColoumnCount(it),Ve.setHandler("plus",mt.plus),Ve.setHandler("del",mt.del),Ve.setHandler("check",mt.check),Ve.setHandler("L",mt.L),Ve.setHandler("G",mt.G),Ve.setHandler("S",mt.S),Ve.setHandler("up",mt.up),Ve.setHandler("low",mt.low),Ve.setHandler("Del",mt.Del),Ve.setHandler("R",mt.R),Ve.setHandler("T",mt.T),Ve.setHandler("X",mt.X),Ve.setHandler("target",mt.target),Ve.setHandler("source",mt.source),Ve.setHandler("in",mt.in),Ve.setHandler("out",mt.out),Ve.setHandler("checkenter",mt.checkenter),Ve.setHandler("Deleteenter",mt.Deleteenter),Ve.setHandler("Renter",mt.Renter),Ve.setHandler("inenter",mt.inenter),Ve.setHandler("outenter",mt.outenter),Ve.setHandler("Senter",mt.Senter),Ve.setHandler("Genter",mt.Genter),Ve.setHandler("Lenter",mt.Lenter),Ve.setHandler("upenter",mt.upenter),Ve.setHandler("lowenter",mt.lowenter),Ve.setHandler("Tenter",mt.Tenter),Ve.setHandler("Xenter",mt.Xenter),Ve.setHandler("targetenter",mt.targetenter),Ve.setHandler("sourceenter",mt.sourceenter),We.setColoumnCount(it),We.setKeySize(rt),We.setNS(st),We.setHandler(pt),gt(),t.addListener(yt),vt=[ot,3*ot+3*rt],ut=Ve.create(ot,ot,"name"),ct.appendChild(ut),dt=We.createAlphabet(ot,2*ot+rt,"L","C"),ct.appendChild(dt),lt.appendChild(ct),ct.setAttributeNS(null,"visibility","hidden"),document.getElementById("inID").style.visibility="hidden"},ft.setNS=e=>{st=e},ft.getNS=()=>st,ft.setKeySize=e=>{rt=e},ft.getKeySize=()=>rt,ft.setColoumnCount=e=>{it=e},ft.getColoumnCount=()=>it,ft.setAlphabetHandler=e=>{pt=e},ft.getAlphabetHandler=()=>pt,ft.setStateKeyHandler=e=>{bt=e},ft.getStateKeyHandler=()=>bt,ft.setPadding=e=>{ot=e},ft.setSpecialKeyHandler=(e,t)=>{mt[e]=t},ft.getSpecialKeyHandler=e=>mt[e],ft.getPadding=()=>ot;var St=ft;let wt={},Ct={},kt={},xt={},Dt={},At=0;const It={updateAlphabetL:()=>{St.updateAlphabet("L","C")},updateAlphabetG:()=>{St.updateAlphabet("G","S")},updateAlphabetS:()=>{St.updateAlphabet("S","S")},updateAlphabetlow:()=>{St.updateAlphabetCase("low")},updateAlphabetup:()=>{St.updateAlphabetCase("up")},letterIn:e=>{switch(wt.state[0]){case"s":kt.stateName(e);break;case"t":Ct.nameAppendRate(e)}},RemoveTolken:()=>{switch(wt.state){case"sr":kt.nameRemoveToken();break;case"tr":Ct.nameRemoveToken()}},check:()=>{switch(wt.state[0]){case"s":kt.checkName();break;case"t":Ct.nameConfirm()}},delete:()=>{switch(wt.state[0]){case"s":kt.stateActivateDelete();break;case"t":xt.rearrangement(),Ct.transitionActivateDelete()}},rename:()=>{switch(wt.state[0]){case"s":kt.stateActivateRename();break;case"t":Ct.transitionActivateRename()}},arrowIn:()=>{xt.specialArrowCreate("in")},arrowOut:()=>{xt.specialArrowCreate("out")},newTransition:()=>{kt.stateActivateTransition(),St.updateSpecialKeys("X")},leaveX:()=>{switch(wt.state){case"s":kt.stateActivateIdle(),St.updateSpecialKeys("s"),It.systemupdate("s");break;case"t":Ct.transitionActivateIdle(),St.updateSpecialKeys("t"),It.systemupdate("t")}},transitiontarget:()=>{Ct.transitionActivateTarget(),St.updateSpecialKeys("X")},transitionsource:()=>{Ct.transitionActivateSource(),St.updateSpecialKeys("X")},showinfo:e=>{let t=window.event,a=document.getElementById("infoID");a.style.left=t.clientX+"px";let n=t.clientY-50;a.style.top=n+"px",a.style.visibility="visible",a.innerHTML=e,0===At&&(At++,setTimeout((function(){a.style.visibility="hidden",At=0}),1250))},systemupdate:e=>{let t=document.getElementById("inID");switch(e){case"s":t.style.visibility="visible",St.visibility("visible"),St.updateSpecialKeys("s"),St.Alphabetvisibility("hidden"),St.StateKeysvisibility("hidden");break;case"sr":t.style.visibility="visible",St.visibility("visible"),It.updateAlphabetL(),St.Alphabetvisibility("visible"),St.updateSpecialKeys("name"),St.StateKeysvisibility("hidden");break;case"sm":t.style.visibility="hidden",St.visibility("hidden"),St.Alphabetvisibility("hidden");break;case"t":switch(wt.activeShape.type){case void 0:t.style.visibility="visible",St.visibility("visible"),St.updateSpecialKeys("t"),St.Alphabetvisibility("hidden"),St.StateKeysvisibility("hidden");break;case"in":t.style.visibility="visible",St.visibility("visible"),St.updateSpecialKeys("tspecialin"),St.Alphabetvisibility("hidden"),St.StateKeysvisibility("hidden");break;case"out":t.style.visibility="visible",St.visibility("visible"),St.updateSpecialKeys("tspecialout"),St.Alphabetvisibility("hidden"),St.StateKeysvisibility("hidden")}break;case"tr":t.style.visibility="visible",St.visibility("visible"),It.updateAlphabetG(),St.Alphabetvisibility("visible"),St.updateSpecialKeys("name"),St.StateKeysvisibility("visible");break;case"tm":case"i":t.style.visibility="hidden",St.visibility("hidden"),St.Alphabetvisibility("hidden"),St.StateKeysvisibility("hidden")}},checkenter:()=>{let e=Dt.check;It.showinfo(e)},Deleteenter:()=>{let e=Dt.Delete;switch(wt.state){case"s":e+=" state";break;case"t":void 0!==wt.activeShape.type?e+=" special arrow":e+=" transition"}It.showinfo(e)},Renter:()=>{let e=Dt.rename;It.showinfo(e)},inenter:()=>{let e=Dt.in;It.showinfo(e)},outenter:()=>{let e=Dt.out;It.showinfo(e)},Senter:()=>{let e=Dt.S;It.showinfo(e)},Genter:()=>{let e=Dt.G;It.showinfo(e)},Lenter:()=>{let e=Dt.L;It.showinfo(e)},upenter:()=>{let e=Dt.up;It.showinfo(e)},lowenter:()=>{let e=Dt.low;It.showinfo(e)},Tenter:()=>{let e=Dt.T;It.showinfo(e)},Xenter:()=>{let e=Dt.X;It.showinfo(e)},tagetenter:()=>{let e=Dt.target;It.showinfo(e)},sourceenter:()=>{let e=Dt.source;It.showinfo(e)},init:(e,t,a,n,s)=>{wt=e,Ct=t,kt=a,xt=n,Dt=s}};var Mt=It;var Tt=class extends re{constructor(e,t,a,n){super(e,t,a),this.type=n}};let Et={},$t={},Kt=0;const Pt={returnstates:e=>{let t,a,n,s=[];for([t,a]of Et.shMap)n=t.substring(0,1),"t"===n&&void 0!==a.type&&(a.source===e?s.push(a.target):a.target===e&&s.push(a.source));return s},specialArrowCreate:e=>{const t=Et.generateFreeID("s"),a=Et.generateFreeID("t");let n,s=$t.activeShape.x,i=$t.activeShape.y,r=0,o=0,l=0,c=0;const h=Pt.returnstates($t.activeShape);for(let e=0;e<h.length;e++)$t.activeShape.x-h[e].x<=0&&$t.activeShape.y-h[e].y>0||h[e].x-$t.activeShape.x>0&&h[e].y-$t.activeShape.y>0?l++:c++;if(l===Kt&&"in"===e||c===Kt&&"out"===e)return alert("Only "+Kt+" specialArrows allowed, limit reached!"),null;const u=Math.PI/Kt;switch(e){case"in":r=100*Math.cos(Math.PI/2-u*l),o=100*Math.cos(u*l);const h=new d(t,s+r,i-o,1);n=new Tt(a,h,$t.activeShape,e);break;case"out":r=100*Math.cos(Math.PI/2-u*c),o=100*Math.cos(u*c);const p=new d(t,s-r,i+o,1);n=new Tt(a,$t.activeShape,p,e)}return Et.addShape(a,n),$t.activeShape.deactivate(),$t.systemStateActivate("tr",n),Et.draw(),!1},rearrangement:()=>{let e=null;switch($t.activeShape.type){case"in":e=$t.activeShape.target;break;case"out":e=$t.activeShape.source}let t,a,n,s=0,i=0,r=0,o=0;const l=Math.PI/Kt;for([t,a]of Et.shMap)n=t.substring(0,1),"t"===n&&void 0!==a.type&&t!=$t.activeShape.id&&(a.source===e?(r=100*Math.cos(Math.PI/2-l*i),o=100*Math.cos(l*i),i++,a.target.move(e.x-r,e.y+o)):a.target===e&&(r=100*Math.cos(Math.PI/2-l*s),o=100*Math.cos(l*s),s++,a.source.move(e.x+r,e.y-o)))},arrangement:(e=$t.activeShape)=>{let t=null;switch(e.type){case"in":t=e.target;break;case"out":t=e.source}let a,n,s,i=0,r=0,o=0,l=0;const c=Math.PI/Kt;for([a,n]of Et.shMap)s=a.substring(0,1),"t"===s&&void 0!==n.type&&(n.source===t?(o=100*Math.cos(Math.PI/2-c*r),l=100*Math.cos(c*r),r++,n.target.move(t.x-o,t.y+l)):n.target===t&&(o=100*Math.cos(Math.PI/2-c*i),l=100*Math.cos(c*i),i++,n.source.move(t.x+o,t.y-l)))},arrangementstate:(e=$t.activeShape)=>{let t,a,n,s=0,i=0,r=0,o=0;const l=Math.PI/Kt;for([t,a]of Et.shMap)n=t.substring(0,1),"t"===n&&void 0!==a.type&&("out"===a.type&&a.source===e?(r=100*Math.cos(Math.PI/2-l*i),o=100*Math.cos(l*i),i++,a.target.move(e.x-r,e.y+o)):"in"===a.type&&a.target===e&&(r=100*Math.cos(Math.PI/2-l*s),o=100*Math.cos(l*s),s++,a.source.move(e.x+r,e.y-o)))},limitspAoutreached:(e=$t.activeShape)=>{let t,a,n,s=0;for([t,a]of Et.shMap)n=t.substring(0,1),"t"===n&&"out"===a.type&&a.source===e&&s++;return s>=Kt},limitspAinreached:(e=$t.activeShape)=>{let t,a,n,s=0;for([t,a]of Et.shMap)n=t.substring(0,1),"t"===n&&"in"===a.type&&a.target===e&&s++;return s>=Kt},init:(e,t,a)=>{Et=e,$t=t,Kt=a}};var Ot=Pt;const Ht={};Ht.help=s,Ht.symbols=l,Ht.alphabet="L",Ht.callback=me.update,Ht.activeShape=null,Ht.selectionTransitionTarget=!1,Ht.selectionTransitionSource=!1,Ht.selectionTransitionFactor=!1,Ht.state="i",Ht.nameOld="",Ht.initState=()=>{let e="n",t=new d(e,0,0,0);Q.addShape(e,t);let a=78;t.nameAddChr(a),e=Q.generateFreeID("s"),t=new d(e,2*c.stateRadius,2*c.stateRadius),Q.addShape(e,t),a=Ht.symbols.L.C.S,t.nameAddChr(a)},Ht.init=()=>{c.canvas=document.getElementById("canvasID"),c.context=c.canvas.getContext("2d"),Q.init(c.canvas,c.stateRadius,c.hitTargetPadding,c.instancesLimit),ue.init(Q,Ht,c.instancesLimit,Ot),Ot.init(Q,Ht,c.specialArrowLimit),ie.init(Q,Ht,ue,c.instancesLimit),Mt.init(Ht,ue,ie,Ot,r),Ht.helpBox=document.getElementById("helpID"),Ht.helpBox.innerHTML=Ht.help.i,V(c.canvas,Ht,ie,ue,c.stateKeys,c.transitionKeys),Ht.initState(),Q.draw(),Ht.callback(Q.shMap)},Ht.systemStateActivate=(e,t)=>{null!=t&&t.activate(),Ht.nameOld=null!=t?t.name:"",Ht.activeShape=t,Ht.state=e,Ht.selectionTransitionFactor=!1,Ht.selectionTransitionSource=!1,Ht.selectionTransitionTarget=!1,Ht.alphabet="tr"===e?"G":"L",Ht.helpBox.innerHTML=Ht.help[e],Mt.systemupdate(e)},Ht.systemStateMouseDown=(e,t)=>{const a=Q.findShape(e,t);let n="i";if(null!=a){n=a.id.substring(0,1)+"m",a.moveStart(e,t);let s=Ot.returnstates(a);if(0!==s.length)for(let a=0;a<s.length;a++)s[a].moveStart(e,t)}"i"!==Ht.state&&Ht.activeShape.deactivate(),Ht.systemStateActivate(n,a),Q.draw()},Ht.moveStop=()=>{if(Ht.state.length>1&&"m"===Ht.state.substring(1,2)){Ht.activeShape.moveStop();let e=Ot.returnstates(Ht.activeShape);if(0!==e.length)for(let t=0;t<e.length;t++)e[t].moveStop();Ht.systemStateActivate(Ht.state.substring(0,1),Ht.activeShape)}},Ht.moveObject=e=>{Ht.activeShape.move(e.offsetX,e.offsetY);let t=Ot.returnstates(Ht.activeShape);if(0!==t.length)for(let a=0;a<t.length;a++)t[a].move(e.offsetX,e.offsetY);for(let e=0;e<t.length;e++)if(t[e].y<2){Ht.moveStop(),Ht.activeShape.move(Ht.activeShape.x,102),t[e].move(t[e].x,2);for(let e=0;e<t.length;e++)t[e].moveStop();Ot.arrangementstate()}else if(t[e].x<Ht.activeShape.radius){Ht.moveStop(),Ht.activeShape.move(Ht.activeShape.radius+102,Ht.activeShape.y);for(let e=0;e<t.length;e++)t[e].moveStop();Ot.arrangementstate()}if(Q.stateconflict(Ht.activeShape)){if(Ht.moveStop(),0!==t.length)for(let e=0;e<t.length;e++)t[e].moveStop();let e=0,a=0,n=1;for(;Q.stateconflict(Ht.activeShape);){for(;e<=n&&Q.stateconflict(Ht.activeShape);e++)if(Ht.activeShape.move(Ht.activeShape.x+e,Ht.activeShape.y+a),0!==t.length)for(let n=0;n<t.length;n++)t[n].move(t[n].x+e,t[n].y+a);for(;a<=n&&Q.stateconflict(Ht.activeShape);a++)if(Ht.activeShape.move(Ht.activeShape.x+e,Ht.activeShape.y+a),0!==t.length)for(let n=0;n<t.length;n++)t[n].move(t[n].x+e,t[n].y+a);for(n++;e>=-n&&Q.stateconflict(Ht.activeShape);e--)if(Ht.activeShape.move(Ht.activeShape.x+e,Ht.activeShape.y+a),0!==t.length)for(let n=0;n<t.length;n++)t[n].move(t[n].x+e,t[n].y+a);for(;a>=-n&&Q.stateconflict(Ht.activeShape);a--)if(Ht.activeShape.move(Ht.activeShape.x+e,Ht.activeShape.y+a),0!==t.length)for(let n=0;n<t.length;n++)t[n].move(t[n].x+e,t[n].y+a);n++}}Q.draw()};var Lt=Ht;const Xt={};let Bt={},Rt={};function Nt(e){const t=[],a=e.nameArr.length,n=e.source;let s,i,r,o=0;if(0===a)return t;for(t[0]=[],s=0;s<a;s+=1)[i,r]=e.nameArr[s],"o"===i?(t[o].push(["s",n]),o+=1,t[o]=[]):0!==r.radius?t[o].push([i,r]):t[o].push(["n",r]);return t[o].push(["s",n]),t}function jt(e){const t=[],a=e.nameArr.length;let n,s,i,r=0;if(0===a)return t;for(t[0]=[],n=0;n<a;n+=1)[s,i]=e.nameArr[n],"o"===s?(r+=1,t[r]=[]):0!==i.radius?t[r].push([s,i]):t[r].push(["n",i]);return t}function Gt(e,t,a){let n;const s=t.length,i=Rt.get(e);for(n=0;n<s;n+=1)i.push({sign:a,prod:t[n]})}Xt.odeBuild=e=>{let t,a,n;for([t,a]of(function(e){let t,a;for([t,a]of(Rt=new Map,e))"s"===t.substring(0,1)&&Rt.set(a,[])}(e),e))"t"===t.substring(0,1)&&(void 0!==a.type?(n=jt(a),"in"===a.type?Gt(a.target,n,1):Gt(a.source,n,-1)):(n=Nt(a),Gt(a.source,n,-1),Gt(a.target,n,1)))},Xt.update=e=>{let t,a,n,s,i,r,o,l,c,d,h,u,p,b=0,m=0,v=[];const f=String.fromCodePoint(8339);for([s,i]of(Xt.odeBuild(e),t="<table>",Rt))if("N"!==s.name){for(v.push(s.name),a="<tr><td align='right'>",a=s.nameArr.length>1?a+"("+s.name+")"+f:a+s.name+f,a+="</td>",a+="<td align='center'>=</td>",a+="<td align='left'><div class='odeEquation'>",r=i.length,p=!1,o=0;o<r;o+=1){for(m=0,n=i[o].sign<0?"–":p?"+":"",l=i[o].prod,c=l.length,d=0;d<c;d+=1)[h,u]=l[d],"s"===h?(u=u.name,m++):u="n"===h?u.name:String.fromCodePoint(u),n+=u;if(m>1){switch(n+="N",n+=String.fromCodePoint(8315),m--,m){case 1:b=185;break;case 2:b=178;break;case 3:b=179;break;default:b=8304+m}n+=String.fromCodePoint(b)}a+=n,p=!0}p||(a+="0"),a+="</div></td></tr>",t+=a}a="<tr><td align='right'>N</td><td align='center'>=</td><td align='left'><div class='odeEquation'>";for(let e=0;e<v.length;e++)e>0&&(a+="+"),a+=v[e];a+="</div></td></tr>",t+=a,t+="</table>",Bt.innerHTML=t},Xt.init=e=>{Bt=e},Xt.getODEs=()=>Rt;var Vt=Xt;var Ft=function(){const e={},t=Vt.getODEs();return e.states=function(e){const t=new Map;return e.forEach((e,a)=>{t.set(a.id,a.name)}),t}(t),e.rates=function(e){const t=new Set;return e.forEach(e=>{e.forEach(e=>{e.prod.forEach(e=>{"r"===e[0]&&t.add(String.fromCodePoint(e[1]))})})}),t}(t),e.equations=function(e){const t=new Map;return e.forEach((e,a)=>{const n=[];e.forEach(e=>{const t={};t.sign=e.sign,t.prod=[],e.prod.forEach(e=>{const a="r"===e[0]?[e[0],String.fromCodePoint(e[1])]:[e[0],e[1].id];t.prod.push(a)}),n.push(t)}),t.set(a.id,n)}),t}(t),e};const Ut={init:()=>{Vt.init(document.getElementById("odeID")),me.addListener(Vt.update),St.setAlphabetHandler(Mt.letterIn),St.setStateKeyHandler(ue.nameAppendState),St.setSpecialKeyHandler("plus",ue.nameAppendPlus),St.setSpecialKeyHandler("del",Mt.RemoveTolken),St.setSpecialKeyHandler("check",Mt.check),St.setSpecialKeyHandler("L",Mt.updateAlphabetL),St.setSpecialKeyHandler("G",Mt.updateAlphabetG),St.setSpecialKeyHandler("S",Mt.updateAlphabetS),St.setSpecialKeyHandler("up",Mt.updateAlphabetup),St.setSpecialKeyHandler("low",Mt.updateAlphabetlow),St.setSpecialKeyHandler("Del",Mt.delete),St.setSpecialKeyHandler("R",Mt.rename),St.setSpecialKeyHandler("T",Mt.newTransition),St.setSpecialKeyHandler("X",Mt.leaveX),St.setSpecialKeyHandler("target",Mt.transitiontarget),St.setSpecialKeyHandler("source",Mt.transitionsource),St.setSpecialKeyHandler("in",Mt.arrowIn),St.setSpecialKeyHandler("out",Mt.arrowOut),St.setSpecialKeyHandler("checkenter",Mt.checkenter),St.setSpecialKeyHandler("Deleteenter",Mt.Deleteenter),St.setSpecialKeyHandler("Renter",Mt.Renter),St.setSpecialKeyHandler("inenter",Mt.inenter),St.setSpecialKeyHandler("outenter",Mt.outenter),St.setSpecialKeyHandler("Genter",Mt.Genter),St.setSpecialKeyHandler("Lenter",Mt.Lenter),St.setSpecialKeyHandler("Senter",Mt.Senter),St.setSpecialKeyHandler("upenter",Mt.upenter),St.setSpecialKeyHandler("lowenter",Mt.lowenter),St.setSpecialKeyHandler("Tenter",Mt.Tenter),St.setSpecialKeyHandler("Xenter",Mt.Xenter),St.setSpecialKeyHandler("targetenter",Mt.tagetenter),St.setSpecialKeyHandler("sourceenter",Mt.sourceenter),St.init(document.getElementById("inID"),me),Lt.init()}};Ut.getODEs=Ft;var Yt=Ut;const zt={};function Jt(){JXG.Options=JXG.merge(JXG.Options,{board:{showNavigation:!1,showCopyright:!1,useMathJax:!0}}),JXG.Options.text.useMathJax=!0,zt.board=JXG.JSXGraph.initBoard("plotID",{boundingbox:[-20,1200,220,-100],axis:!1,keepaspectratio:!1,showCopyright:!1,showNavigation:!1,zoom:{factorX:1.25,factorY:1.25,wheel:!0,needshift:!1,eps:.1}}),function(){const e=zt.board.create("point",[0,0],{needsRegularUpdate:!1,visible:!1}),t=zt.board.create("point",[1,0],{needsRegularUpdate:!1,visible:!1}),a=zt.board.create("axis",[e,t],{needsRegularUpdate:!1,name:"$t$",withLabel:!0,label:{position:"rt",offset:[-5,8]}});let n,s,i;a.removeAllTicks(),zt.board.create("ticks",[a,1],{offset:[-10,-10],precision:5,minorTicks:0,drawLabels:!0,grid:!0,majorHeight:-1,strokeColor:"#ccc"}).ticksFunction=()=>n,zt.board.fullUpdate();const r=zt.board.create("point",[0,0],{needsRegularUpdate:!1,visible:!1}),o=zt.board.create("point",[0,1],{needsRegularUpdate:!1,visible:!1}),l=zt.board.create("axis",[r,o],{needsRegularUpdate:!1,withLabel:!0,label:{position:"rt",offset:[-5,8]}});l.removeAllTicks();const c=zt.board.create("ticks",[l,1],{strokeColor:"#ccc",label:{offset:[10,0]},precision:8,minorTicks:0,drawLabels:!0,drawZero:!1,majorHeight:-1});c.ticksFunction=()=>s,zt.board.fullUpdate();const d=function(){i=zt.board.getBoundingBox();const e=10**Math.floor(Math.log10(.6*(i[2]-i[0])));n=(i[2]-i[0])/e>5?e:.5*e;const t=10**Math.floor(Math.log10(.6*(i[1]-i[3])));s=(i[1]-i[3])/t>5?t:.5*t,zt.board.fullUpdate()};d(),zt.board.create("point",[0,0],{visible:!1}),zt.upperAxis=30,zt.lowerAxis=zt.board.canvasHeight-30,zt.boardRestriction=!0,zt.yLogFunc=function(){console.time("yLog"),this.checked?(zt.board.setBoundingBox([-zt.tEnd.X()/10,10,1.1*zt.tEnd.X(),-Math.log10(1/zt.eps)-1],!1),c.generateLabelText=(e,t)=>e.usrCoords[2]-t.usrCoords[2]<-Math.log10(1/zt.eps)?"":e.usrCoords[2]-t.usrCoords[2]<1-Math.log10(1/zt.eps)?"0":"$10^{"+Math.floor(e.usrCoords[2]-t.usrCoords[2])+"}$",zt.yPre=e=>e>Math.log10(zt.eps)?10**e:0,zt.yPost=e=>Math.abs(e)>zt.eps?Math.log10(Math.abs(e)):Math.log10(zt.eps),zt.move=e=>e>zt.eps?Math.log10(e):Math.log10(zt.eps),zt.boardRestriction=!1,zt.board.highlightInfobox=function(e,t,a){t<=-Math.log10(1/zt.eps)?zt.board.infobox.setText(" ("+e+",0)"):zt.board.infobox.setText(" ("+e+" , $"+(10**t*10**Math.ceil(-t-1)%1*10).toFixed(2)+"\\cdot 10^{"+Math.ceil(-t)+"}$)")}):(zt.board.setBoundingBox([-zt.tEnd.X()/10,1200,1.1*zt.tEnd.X(),-100],!1),c.generateLabelText=function(e,t){return e.usrCoords[2]-t.usrCoords[2]},zt.yPost=e=>e,zt.yPre=e=>e,zt.move=e=>e>Math.log10(zt.eps)?10**e:0,zt.boardRestriction=!0,zt.board.highlightInfobox=function(e,t,a){zt.board.infobox.setText("("+e+", "+t+")")}),zt.board.fullUpdate(),d(),console.timeEnd("yLog")},window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]]},jax:["input/TeX","output/HTML-CSS"],svg:{fontCache:"global"},startup:{promise:new Promise((function(e,t){setTimeout(()=>e(1),100)}))}},(()=>{const e=document.createElement("script");e.src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js",e.async=!0,document.head.appendChild(e)})(),zt.promise=new Promise((e,t)=>{setTimeout(()=>e(1),100)}),zt.typeset=function(e){return window.MathJax.startup.promise=window.MathJax.startup.promise.then(()=>(e(),window.MathJax.typesetPromise())).catch(e=>console.log("Typeset failed: "+e.message)),window.MathJax.startup.promise},zt.eps=1e-12,zt.yPre=e=>e,zt.yPost=e=>e,zt.move=e=>e>Math.log10(zt.eps)?10**e:0,$("#plotID").mouseenter(()=>{zt.helpID=$("#helpID").html(),$("#helpID").html("Scroll to zoom in and out. Hold <b>SHIFT</b> to pan.<br>To change interventions either drag them or hold <b>SHIFT</b> and click to enter coordinates directly. <br>Press <b>+</b> button to add an intervention and press <b>&#8211</b> button to remove last intervention.Switch <b>Log</b> checkbox to switch y-axis to logarithmic scale.<br>Press any checkbox in the <b>legend</b> to hide corresponding function graph.<br>")}),$("#plotID").mouseleave(()=>{$("#helpID").html(zt.helpID)}),$("#ratesID").mouseenter(()=>{zt.helpID=$("#helpID").html(),$("#helpID").html("Values can be adjusted by either directly changing the numerical value or by scrolling/ dragging the graph .<br>Click on intervention tab to view corresponding rates .<br>")}),$("#ratesID").mouseleave(()=>{$("#helpID").html(zt.helpID)}),$("#statesID").mouseenter(()=>{zt.helpID=$("#helpID").html(),$("#helpID").html("Values can be adjusted by either directly changing the numerical value or by scrolling/ dragging the graph .<br>")}),$("#statesID").mouseleave(()=>{$("#helpID").html(zt.helpID)}),$("#GraphButtons").html('<span float="right" class="slider-checkbox"><input type="checkbox" id="logY" /><label class="label" for="logY"></label><button class="button" id="button">+</button>&nbsp<button class="button" id="button2">&#8211</button>')}()}function _t(){!function(){const e=zt.board.create("line",[[0,0],[1,0]],{visible:!1});zt.tEnd=zt.board.create("glider",[200,0,e],{name:"$t_{\\infty}$",color:"black"}),zt.board.setBoundingBox([-zt.tEnd.X()/10,1200,1.1*zt.tEnd.X(),-100],!1),zt.tEnd.on("up",(function(e){const t=this;zt.promise=zt.promise.then(()=>{if(e.shiftKey&&null==zt.input){const e=zt.board.getBoundingBox();zt.typeset(()=>{zt.input=zt.board.create("text",[(e[2]+e[0])/2.5,(e[1]+e[3])/2,'<div id="inputID"><p>Enter Value of $t_\\\\infty$</p><br><input type="float" id="xValue" required value='+t.X()+'><br><br><button class="button" id="Accept">Accept</button></div>'],{fixed:!0,highlight:!1})}).then(()=>{$("#Accept").click(()=>{t.moveTo([$("#xValue").val(),0]),zt.board.removeObject(zt.input),zt.input=null,zt.plotCurves(),zt.board.setBoundingBox([-zt.tEnd.X()/10,e[1],1.1*zt.tEnd.X(),e[3]],!1)})})}zt.plotCurves();const a=zt.board.getBoundingBox();return zt.board.setBoundingBox([-zt.tEnd.X()/10,a[1],1.1*zt.tEnd.X(),a[3]],!1),new Promise((function(e,t){setTimeout(()=>e(1),100)}))})}))}(),function(){function e(e){return e<=zt.eps?Math.log10(zt.eps):1===e?Math.log10(1+zt.eps):Math.log10(e)}function t(e){return e<=Math.log10(zt.eps)?0:10**e}zt.saveStates=()=>{zt.data.states={},Object.keys(zt.states).forEach(e=>{zt.data.states[e]={},zt.data.states[e].value=zt.states[e].getValue(),zt.data.states[e].name=zt.states[e].name})},zt.saveInterventions=()=>{zt.data.interventions={},Object.keys(zt.interventions).forEach(e=>{zt.data.interventions[e]=zt.interventions[e].getValue()})},zt.saveRates=()=>{zt.data.rates={},Object.keys(zt.rates).forEach(e=>{zt.data.rates[e]={},Object.keys(zt.interventions).forEach(t=>{zt.data.rates[e][t]=zt.rates[e][t].getValue()})})},zt.save=()=>{zt.saveStates(),zt.saveRates(),zt.saveInterventions()},zt.loadStates=()=>{zt.statesMap={},zt.board.suspendUpdate(),Object.values(zt.states).forEach(e=>{zt.board.removeObject(e.plotPoint),JXG.JSXGraph.freeBoard(e.board)}),Object.values(zt.curves).forEach(e=>{zt.board.removeObject(e)}),zt.board.removeObject(zt.labels),zt.board.unsuspendUpdate(),zt.states={};for(let e=0;e<Object.keys(zt.data.states).length;e++)zt.statesMap[Object.keys(zt.data.states)[e]]=e;const a=zt.board.create("line",[()=>-1*zt.interventions.t0.getValue(),()=>1,()=>0],{visible:!1});$("#statesID").empty(),$("#statesID").append("<table>"),document.getElementById("statesID").style.display="block",Object.keys(zt.data.states).forEach(n=>{zt.states[n]={},zt.states[n].name=zt.data.states[n].name,$("#statesID").append('<tr><td><div class="stateName" >'+zt.states[n].name+'(0) = </div></td><td><div contenteditable="true" class="stateText"  id= "text'+n+'">'+(zt.data.states[n].value<zt.eps?(0).toExponential(3):zt.data.states[n].value.toExponential(3))+'</div></td><td><div class="stateBoard" tabindex="1" id= "board'+n+'"></div></td></tr>'),zt.states[n].board=JXG.JSXGraph.initBoard("board"+n,{axis:!1,maxboundingbox:[-1/0,1/0,1/0,-1/0],showCopyright:!1,showNavigation:!1,showInfobox:!1,highlight:!1,highlightInfobox:!1,pan:{enabled:!0,needshift:!1},zoom:{factorX:1.05,factorY:1,wheel:!0,needshift:!1,eps:.01}}),zt.states[n].point=zt.states[n].board.create("point",[e(zt.data.states[n].value),0],{name:zt.data.states[n].name,visible:!0,highlight:!1,highlightInfobox:!1,label:{offset:[0,-25]},color:zt.colors[zt.statesMap[n]],fixed:!0,showInfobox:!1}),zt.states[n].board.setBoundingBox([e(zt.data.states[n].value)-2,.1,e(zt.data.states[n].value)+2,-.1]),zt.states[n].point.setAttribute({frozen:!0}),zt.states[n].getValue=function(){return t(this.point.X())};const s=zt.states[n].board.create("axis",[[0,0],[1,0]]);s.removeAllTicks(),zt.states[n].board.create("ticks",[s,1],{drawLabels:!0,minorTicks:0,drawZero:!0,generateLabelText:(e,t)=>e.usrCoords[1]-t.usrCoords[1]<=-12?0:"$10^{"+1*Math.floor(e.usrCoords[1]-t.usrCoords[1])+"}$"}),zt.states[n].plotPoint=zt.board.create("glider",[0,t(zt.states[n].point.X()),a],{color:zt.colors[zt.statesMap[n]],name:zt.data.states[n].name+"(0)",label:{autoPosition:!0,visible:!1},showInfobox:!1,highlight:!1,fixed:!0}),zt.states[n].board.on("boundingbox",()=>{const e=zt.states[n].board.getBoundingBox();zt.states[n].board.setBoundingBox([e[2]-4,.1,e[2],-.1]);zt.states[n].getValue()<=zt.eps?document.getElementById("text"+n).innerHTML=(0).toExponential(3):document.getElementById("text"+n).innerHTML=zt.states[n].getValue().toExponential(3),zt.states[n].plotPoint.setPositionDirectly(JXG.COORDS_BY_USER,[0,zt.yPost(t(zt.states[n].point.X()))]),zt.plotCurves()}),$(document).focusout("#text"+n,()=>{"block"===$("#statesID").css("display")&&(zt.states[n].plotPoint.setPositionDirectly(JXG.COORDS_BY_USER,[0,zt.yPost(parseFloat($("#text"+n).text()))]),zt.states[n].board.setBoundingBox([e(parseFloat($("#text"+n).text()))-2,.1,e(parseFloat($("#text"+n).text()))+2,-.1]))})}),$("#statesID").append("</table>"),document.getElementById("statesID").style.display="none",zt.curves={},Object.keys(zt.data.states).forEach(e=>{zt.curves[e]=zt.board.create("curve",[0,0],{strokeColor:zt.colors[zt.statesMap[e]],name:zt.data.states[e].name+"(t)",highlight:!1}),zt.curves.n=zt.board.create("curve",[0,0],{strokeColor:"black",name:"N(t)",highlight:!1})}),zt.setLegend(),zt.setLegendFunction()},zt.loadInterventions=()=>{zt.board.suspendUpdate(),Object.values(zt.interventions).forEach(e=>{zt.board.removeObject(e.line.point1),zt.board.removeObject(e.line.point2),zt.board.removeObject(e.line),zt.board.removeObject(e.point)}),zt.board.unsuspendUpdate(),zt.board.update(),zt.interventions={};const t=zt.board.create("line",[[0,0],[1,0]],{visible:!1});$("#tabtab3ID").empty(),Object.keys(zt.data.interventions).forEach(a=>{zt.interventions[a]={},zt.interventions[a].point=zt.board.create("glider",[zt.data.interventions[a],0,t],{color:"black",visible:!0,name:"$t_{"+a.substring(1)+"}$"}),zt.interventions[a].line=zt.board.create("line",[[()=>zt.interventions[a].point.X(),0],[()=>zt.interventions[a].point.X(),1]],{color:"lightGrey",visible:!0}),zt.interventions[a].point.on("up",(function(e){const t=this;zt.promise=zt.promise.then(()=>{if(e.shiftKey&&null==zt.input){const e=zt.board.getBoundingBox();zt.typeset(()=>{zt.input=zt.board.create("text",[(e[2]+e[0])/2.5,(e[1]+e[3])/2,'<div id="inputID"><p>Enter Value of $t_\\\\infty$</p><br><input type="float" id="xValue" required value='+t.X()+'><br><br><button class="button" id="Accept">Accept</button></div>'],{fixed:!0,highlight:!1})}).then(()=>{$("#Accept").click(()=>{t.moveTo([$("#xValue").val(),0]),zt.board.removeObject(zt.input),zt.input=null,zt.plotCurves()})})}return zt.plotCurves(),new Promise((function(e,t){setTimeout(()=>e(1),100)}))})})),zt.interventions[a].getValue=function(){return this.point.X()},$("#tabtab3ID").append('<button id = "button'+a+'">t<sub>'+a.substring(1)+"</sub></button>"),$("#button"+a).click(()=>{zt.activeIntervention=a,$("#tabtab3ID").children().removeClass("active"),$("#button"+a).addClass("active"),Object.keys(zt.rates).forEach(t=>{Object.keys(zt.interventions).forEach(e=>{zt.rates[t][e].point.setAttribute({visible:!1,frozen:!1})}),zt.rates[t].board.setBoundingBox([e(zt.rates[t][a].getValue())-2,.1,e(zt.rates[t][a].getValue())+2,-.1]),zt.rates[t][a].point.setAttribute({visible:!0,frozen:!0})})})}),zt.interventions.t0.line.setAttribute({visible:!1}),$("#buttont0").addClass("active"),zt.activeIntervention="t0"},zt.loadRates=()=>{zt.rates={},$("#ratesID").empty(),$("#ratesID").append("<table>"),document.getElementById("ratesID").style.display="block",Object.keys(zt.data.rates).forEach(a=>{zt.rates[a]={},$("#ratesID").append('<tr><td><div class="rateName" >'+a+'= </div></td><td><div contenteditable="true" class="rateText"  id= "text'+a+'">'+zt.data.rates[a].t0+'</div></td><td><div class="rateBoard"  id= "board'+a+'"></div></td></tr>'),zt.rates[a].board=JXG.JSXGraph.initBoard("board"+a,{axis:!1,maxboundingbox:[-1/0,1/0,1/0,-1/0],boundingbox:[-.6,.1,1,-.1],showCopyright:!1,showNavigation:!1,showInfobox:!1,highlight:!1,pan:{enabled:!0,needshift:!1},zoom:{factorX:1.05,factorY:1,wheel:!0,needshift:!1,eps:.01}});const n=zt.rates[a].board.create("axis",[[0,0],[1,0]]);n.removeAllTicks(),zt.rates[a].board.create("ticks",[n,1],{drawLabels:!0,minorTicks:0,drawZero:!0,generateLabelText:(e,t)=>e.usrCoords[1]-t.usrCoords[1]<=-12?0:"$10^{"+1*Math.floor(e.usrCoords[1]-t.usrCoords[1])+"}$"}),Object.keys(zt.data.rates[a]).forEach(n=>{zt.rates[a][n]={},zt.rates[a][n].point=zt.rates[a].board.create("point",[e(zt.data.rates[a][n]),0],{name:a,visible:!1,label:{offset:[0,-25]},color:"black",fixed:!0,showInfobox:!1,highlight:!1}),zt.rates[a][n].getValue=function(){return t(this.point.X())},zt.rates[a].board.on("boundingbox",()=>{const e=zt.rates[a].board.getBoundingBox();zt.rates[a].board.setBoundingBox([e[2]-4,.1,e[2],-.1]);zt.rates[a][zt.activeIntervention].getValue()<=zt.eps?document.getElementById("text"+a).innerHTML=(0).toExponential(3):document.getElementById("text"+a).innerHTML=zt.rates[a][zt.activeIntervention].getValue().toExponential(3),zt.plotCurves()}),$(document).focusout("#text"+a,()=>{"block"===$("#ratesID").css("display")&&zt.rates[a].board.setBoundingBox([e(parseFloat($("#text"+a).text()))-2,.1,e(parseFloat($("#text"+a).text()))+2,-.1])})})}),$("#ratesID").append("</table>"),Object.keys(zt.data.rates).forEach(t=>{zt.rates[t].board.setBoundingBox([e(zt.data.rates[t].t0)-2,.1,e(zt.data.rates[t].t0)+2,-.1]),zt.rates[t].t0.point.setAttribute({visible:!0,frozen:!0})})}}(),zt.data.states={},zt.data.states.s0={},zt.data.states.s0.name="S",zt.data.states.s0.value=1e3,zt.data.interventions={},zt.data.interventions.t0=0,zt.data.rates={},zt.load()}function Wt(){$("#button").click(()=>{console.time("addIntervention"),zt.save(),zt.data.interventions["t"+Object.keys(zt.data.interventions).length]=zt.data.interventions["t"+(Object.keys(zt.data.interventions).length-1)]+10,Object.keys(zt.data.rates).forEach(e=>{zt.data.rates[e]["t"+Object.keys(zt.data.rates[e]).length]=zt.data.rates[e]["t"+(Object.keys(zt.data.rates[e]).length-1)]}),zt.load(),console.timeEnd("addIntervention"),zt.plotCurves()}),$("#button2").click(()=>{console.time("removeIntervention"),zt.save(),Object.keys(zt.data.interventions).length>=2&&(delete zt.data.interventions["t"+(Object.keys(zt.data.interventions).length-1)],Object.keys(zt.data.rates).forEach(e=>{delete zt.data.rates[e]["t"+Object.keys(zt.data.interventions).length]})),zt.load(),console.timeEnd("removeIntervention"),zt.plotCurves()}),$("#logY").change((function(){zt.yLogFunc.call(this),Object.keys(zt.states).forEach(e=>{zt.states[e].plotPoint.moveTo([zt.states[e].plotPoint.X(),zt.move(zt.states[e].plotPoint.Y())])}),zt.plotCurves()}))}zt.curves={},zt.data={},zt.states={},zt.rates={},zt.statesMap={},zt.interventions={},zt.load=()=>{$("#ratesID").show(),$("#tab3ID").show(),$("#statesID").hide(),zt.loadInterventions(),$("#ratesID").hide(),$("#tab3ID").hide(),$("#statesID").show(),zt.loadStates(),$("#ratesID").show(),$("#tab3ID").show(),$("#statesID").hide(),zt.loadRates(),$("#ratesID").hide(),$("#tab3ID").hide(),$("#statesID").show(),$("#Values").addClass("active"),$("#Rates").removeClass("active")},zt.update=()=>{zt.save();const e=Yt.getODEs();e.states.forEach((e,t)=>{Object.keys(zt.data.states).includes(t)?zt.data.states[t].name!==e&&(zt.data.states[t].name=e):(zt.data.states[t]={},zt.data.states[t].name=e,zt.data.states[t].value=0)}),Object.keys(zt.data.states).forEach(t=>{e.states.has(t)||delete zt.data.states[t]}),e.rates.forEach(e=>{Object.keys(zt.data.rates).includes(e)||(zt.data.rates[e]={},Object.keys(zt.data.interventions).forEach(t=>{zt.data.rates[e][t]=.1}))}),Object.keys(zt.data.rates).forEach(t=>{e.rates.has(t)||delete zt.data.rates[t]}),zt.load(),zt.plotCurves()},zt.pointArray=[],zt.interventionArray=[],zt.colors=["red","blue","green","purple","orange","gray","pink","yellow","teal","Brown","BlueViolet","CadetBlue","Chartreuse","Chocolate","CornflowerBlue","Coral","Crimson","Cyan","DarkMagenta","DarkGreen","Fuchsia","Indigo","Khaki","Lime","Magenta","Maroon","Navy","Olive"],zt.setLegend=()=>{let e="",t="<br>";e+=" .switch { position: relative; display: inline-block; width: 30px; height: 18px;}",e+=".switch input {opacity: 0;width: 0;height: 0;}",e+=".slidern {position: absolute; cursor: pointer;top: 0;left: 0;right: 0;bottom: 0;background-color: #ccc;-webkit-transition: 0.4s;transition: 0.4s;}",e+='.slidern:before {position: absolute;content: ""; height: 13px; width: 13px; left: 2px;bottom: 2px; background-color: white;-webkit-transition: 0.4s;transition: 0.4s;}',e+="input:checked + .slidern {background-color:",e+="black",e+=";}",e+="input:focus + .slidern {box-shadow: 0 0 1px grey;}",e+="input:checked + .slidern:before {-webkit-transform: translateX(13px); -ms-transform: translateX(13px); transform: translateX(13px);}",e+=".slidern.round {border-radius: 17px;}",e+=".slidern.round:before {border-radius: 50%;}",t+='<label class="switch">',t+='<input type="checkbox" id="checkn" name="checkn" checked> n',t+='<span class="slidern round"></span></label><span> ',t+="N",t+="(t)  &nbsp&nbsp</span><br>",Object.keys(zt.curves).forEach(a=>{"n"!==a&&(e+=".slider"+a+" {position: absolute; cursor: pointer;top: 0;left: 0;right: 0;bottom: 0;background-color: #ccc;-webkit-transition: 0.4s;transition: 0.4s;}",e+=".slider"+a+':before {position: absolute;content: ""; height: 13px; width: 13px; left: 2px;bottom: 2px; background-color: white;-webkit-transition: 0.4s;transition: 0.4s;}',e+="input:checked + .slider"+a+" {background-color:",e+="n"===a?"black":zt.colors[zt.statesMap[a]],e+=";}",e+="input:focus + .slider"+a+" {box-shadow: 0 0 1px "+zt.colors[zt.statesMap[a]]+";}",e+="input:checked + .slider"+a+":before {-webkit-transform: translateX(13px); -ms-transform: translateX(13px); transform: translateX(13px);}",e+=".slider"+a+".round {border-radius: 17px;}",e+=".slider"+a+".round:before {border-radius: 50%;}",t+='<label class="switch">',t+='<input type="checkbox" id="check'+a+'" name="check'+a+'" checked> '+a,t+='<span class="slider'+a+' round"></span></label><span> ',t+="n"===a?"N":zt.states[a].name,t+="(t)  &nbsp&nbsp</span><br>")});const a=document.createElement("style");a.type="text/css",a.innerHTML=e,document.getElementsByTagName("head")[0].appendChild(a);const n=zt.board.getBoundingBox();zt.labels=zt.board.create("text",[n[2],(n[1]+n[3])*(.55+.03*Object.keys(zt.curves).length),t],{frozen:!0,fontSize:18,fixed:!0,visible:!0,anchorX:"right",anchorY:"top",highlight:!1})},zt.setLegendFunction=()=>{Object.keys(zt.curves).forEach(e=>{$("#check"+e).on("click",(function(){this.checked?zt.curves[e].setAttribute({visible:!0}):zt.curves[e].setAttribute({visible:!1})}))})};var qt=function(){Wt()};var Zt=function(){console.time("Ode");const e=Yt.getODEs(),t={};function a(e){return Object.keys(zt.interventions).includes("t"+(1+parseInt(e.substring(1),10)))?zt.interventions["t"+(1+parseInt(e.substring(1),10))].getValue():zt.tEnd.X()}zt.delta=20,Object.keys(zt.interventions).forEach(a=>{t[a]=function(t){return function(a,n){const s=n.map(()=>0);let i,r=0;return e.equations.forEach((e,t)=>{r+=n[zt.statesMap[t]]}),e.equations.forEach((e,a)=>{e.forEach(e=>{i=!1;let o=e.sign>0?1:-1;e.prod.forEach(e=>{"r"===e[0]?o*=zt.rates[e[1]][t].getValue():"n"===e[0]?o*=r:(i?(o*=n[zt.statesMap[e[1]]],o/=r):o*=n[zt.statesMap[e[1]]],i=!0)}),s[zt.statesMap[a]]+=o})}),s}}(a)});let n=[[]];e.states.forEach((e,t)=>{n[0][zt.statesMap[t]]=zt.states[t].getValue()}),Object.keys(zt.interventions).sort((e,t)=>e.substring(1)<t.substring(1)?-1:1).forEach(e=>{n=n.concat(JXG.Math.Numerics.rungeKutta("rk4",n[n.length-1],[zt.interventions[e].getValue(),a(e)],(a(e)-zt.interventions[e].getValue())*zt.delta+1,t[e]).slice(1))});for(let e=0;e<n.length;e++){let t=0;n[e][n[n.length-1].length]=zt.interventions.t0.getValue()+e/zt.delta;for(let a=0;a<n[e].length-1;a++)t+=n[e][a];n[e].unshift(t)}return console.timeEnd("Ode"),n};var Qt=function(){zt.plotCurves=function(e,t){let a=-1;return function(){clearTimeout(a);const n=arguments,s=this;a=setTimeout((function(){e.apply(s,n)}),t)}}(()=>{const e=Zt();console.time("Plot"),Object.keys(zt.curves).forEach(t=>{zt.curves[t].dataX=[],zt.curves[t].dataY=[];for(let a=0;a<1e3;a++)zt.curves[t].dataX[a]=e[Math.floor(a*e.length/1e3)][e[0].length-1],zt.curves[t].dataY[a]="n"===t?zt.yPost(e[Math.floor(a*e.length/1e3)][0]):zt.yPost(e[Math.floor(a*e.length/1e3)][zt.statesMap[t]+1])}),zt.board.update(),console.timeEnd("Plot")},20)};function ea(){$("#Designer").click(()=>{$("#fsmID").show(),$("#odeID").show(),$("#inID").show(),$("#plotID").hide(),$("#tab2ID").hide(),$("#statesID").hide(),$("#ratesID").hide(),$("#tab3ID").hide(),$("#GraphButtons").hide(),$("#Simulator").removeClass("active"),$("#Designer").addClass("active")}),$("#Simulator").click(()=>{$("#fsmID").hide(),$("#odeID").hide(),$("#inID").hide(),$("#plotID").show(),$("#tab2ID").show(),$("#GraphButtons").show(),$("#Simulator").addClass("active"),$("#Designer").removeClass("active"),Object.values(zt.rates).forEach(e=>{e.board.update()})}),$("#Rates").click(()=>{$("#ratesID").show(),$("#tab3ID").show(),$("#statesID").hide(),$("#Rates").addClass("active"),$("#Values").removeClass("active"),Object.values(zt.rates).forEach(e=>{e.board.update()})}),$("#Values").click(()=>{$("#ratesID").hide(),$("#tab3ID").hide(),$("#statesID").show(),$("#Values").addClass("active"),$("#Rates").removeClass("active"),Object.values(zt.states).forEach(e=>{e.board.update()})}),document.getElementById("Designer").click(),Yt.init(),document.getElementById("Simulator").click(),document.getElementById("Rates").click(),$("#Simulator").click(e=>{$("#fsmID").hide(),$("#odeID").hide(),$("#inID").hide(),$("#plotID").show(),$("#tab2ID").show(),$("#GraphButtons").show(),$("#Simulator").addClass("active"),$("#Designer").removeClass("active"),0!==Object.keys(zt).length&&zt.update(),document.getElementById("Rates").click()}),Jt(),Qt(),_t(),qt(),zt.plotCurves(),document.getElementById("Designer").click()}document.addEventListener("DOMContentLoaded",()=>{ea()})}]);